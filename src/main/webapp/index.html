<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
<div class="container">

<!-- MISC -->
<script>
	var user;
	var request;
	var empRequests;
	var pendingRequests;
	var resolvedRequests;
	var employees;

	function show(id){
		document.getElementById(id).removeAttribute("style");
	};

	function hide(id){
		document.getElementById(id).setAttribute("style","display:none");
	};

	function showAll(className){
		let elems = document.getElementsByClassName(className);
		for (i = 0; i < elems.length; i++){
			elems[i].removeAttribute("style");
		};
	};

	function hideAll(className){
		let elems = document.getElementsByClassName(className);
		for (i = 0; i < elems.length; i++){
			elems[i].setAttribute("style","display:none");
		};
	};

	function updateFullNames(){
		let fullnames = document.getElementsByClassName("full-name");
		for (i = 0; i < fullnames.length; i++){
			fullnames[i].innerHTML = user.fullName;
		};
	};

</script>

<!-- LOGIN -->
<div id="login-page">

	<div><h1>Please Login:</h1></div>
	<div><label for="username">Username:</label><input name="username" id="username" type="text"></div>
	<div><label for="password">Password:</label><input name="password" id="password" type="password"></div>
	<br>
	<div><button class="btn btn-default" onclick="login()">Login</button></div>
	<p id="login-loading" style="display:none">Loading...</p>
	<p id="invalid-login" style="display:none">Invalid Login. Please try again.</p>
	<p id="logout-message" style="display:none">Logout Successful.</p>

</div>

<script>
	function login(){
		show("login-loading");
		hide("invalid-login");
		let xhttp = new XMLHttpRequest();
		let username = document.getElementById("username");
		let password = document.getElementById("password");
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				if (this.getResponseHeader("valid-login") == 1){
					username.value = null;
					password.value = null;
					hide("login-page");
					user = JSON.parse(this.getResponseHeader("user"));
					if (user.isManager == 0){
						show("new-request");
					} else {
						show("all-employees");
					};
					updateFullNames();
					show("main");
				} else {
					show("invalid-login");
				};
				hide("login-loading");
			};
		};
		xhttp.open("post", "/ProjectOne/login.do", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send("username="+username.value+"&password="+password.value);
	};
</script>

<!-- MAIN PAGE -->

<div id="main" style="display:none" class="logged-in">

	<div>
		<h1>Welcome, <span class="full-name"></span></h1>
	</div>
	<div id="user-options-1">
		<h3>Options:</h3>
		<button class="btn btn-default" onclick="logout()">Logout</button>
		<button class="btn btn-default" onclick="changeName()">Change Name</button>
		<button class="btn btn-default" onclick="changePassword()">Change Password</button>
	</div><br>
	<p id="name-change-success" style="display:none">Name successfully updated.</p>
	<p id="password-change-success" style="display:none">Name successfully updated.</p>
	<p id="main-loading" style="display:none">Loading...</p><br>
	<div id="user-options-2">
		<button class="btn btn-default logged-in" id="new-request" style="display:none">Create New Request</button>
		<button class="btn btn-default logged-in" id="all-employees" style="display:none">View All Employees</button>
		<button class="btn btn-default" onclick="viewPendingRequests()">View Pending Requests</button>
		<button class="btn btn-default">View Resolved Requests</button>
	</div>

</div>

<script>

	function logout(){
		show("main-loading");
		user = null;
		hideAll("logged-in");
		show("logout-message");
		show("login-page");
		hide("main-loading");
	};

	function changeName(){
		document.getElementById("firstName").value = user.firstName;
		document.getElementById("lastName").value = user.lastName;
		hide("main");
		show("change-name");
	};

	function changePassword(){
		hide("main");
		show("change-password");
	};

	function viewPendingRequests(){
		show("main-loading");
		if (user.isManager == 1){
			managerViewAllPending();
		} else {
			employeeViewPending();
		};
	};

	function managerViewAllPending(){

	};

	function employeeViewPending(){
		let xhttp = new XMLHttpRequest();

		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				pendingRequests = this.getResponseHeader("pendings");
				hide("main");
				show("emp-view-pendings");
			};
		};
		xhttp.open("post", "/ProjectOne/employeeViewPending.do", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send("userId="+user.id);

	};

</script>

<!-- CHANGE NAME -->

<div id="change-name" style="display:none" class="logged-in">

	<div>
		<h1>Name Change</h1>
		<h4>Please enter your new name:</h4>
	</div>
	<div><label for="firstName">First Name:</label><input name="firstName" id="firstName" type="text"></div>
	<div><label for="lastName">Last Name:</label><input name="lastName" id="lastName" type="text"></div>
	<div><button class="btn btn-default" id="saveNewName" onclick="updateName()">Save</button></div>
	<p id="change-name-loading" style="display:none">Loading...</p>

</div>

<script>

	function updateName(){
		show("change-name-loading");
		let xhttp = new XMLHttpRequest();
		let firstName = document.getElementById("firstName").value;
		let lastName = document.getElementById("lastName").value;
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				user = JSON.parse(this.getResponseHeader("user"));
				hide("change-name");
				hide("change-name-loading");
				show("name-change-success");
				updateFullNames();
				show("main");
			};
		};
		xhttp.open("post", "/ProjectOne/updateName.do", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send("id="+user.id+"&firstName="+firstName+"&lastName="+lastName);
		console.log(user.id);
		console.log(firstName);
		console.log(lastName);
	};

</script>

<!-- CHANGE PASSWORD -->

<div id="change-password" style="display:none" class="logged-in">

	<div>
		<h1>Update Password:</h1>
	</div>
	<div><label for="oldPass">Current Password:</label>
		<input name="oldPass" id="oldPass" type="password"></div>
	<div><label for="newPass">New Password:</label>
		<input name="newPass" id="newPass" type="password"></div>
	<div><label for="confPass">Confirm New Password:</label>
		<input name="confPass" id="confPass" type="password"></div>

	<div><button class="btn btn-default" id="saveNewPassword" onclick="updatePassword()">Update Password</button></div>
	<p id="change-password-loading" style="display:none">Loading...</p>
	<p id="invalid-password" style="display:none">Invalid Password(s). Please try again.</p>


</div>

<script>

	function updatePassword(){
		show("change-password-loading");
		let xhttp = new XMLHttpRequest();
		let oldPass = document.getElementById("oldPass");
		let newPass = document.getElementById("newPass");
		let confPass = document.getElementById("confPass");
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {			
				if (this.getResponseHeader("valid-passwords") == 1){
					hide("change-password");
					user = JSON.parse(this.getResponseHeader("user"));
					show("password-change-success");
					show("main");
				} else {
					show("invalid-password");
				};
				oldPass.value = null;
				newPass.value = null;
				confPass.value = null;
				hide("change-password-loading");
			};
		};
		xhttp.open("post", "/ProjectOne/updatePassword.do", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send("id="+user.id+"&oldPass="+oldPass.value+"&newPass="+newPass.value+"&confPass="+confPass.value);
	};

</script>

<!-- EMPLOYEE VIEW PENDINGS -->

<div id="emp-view-pendings" style="display:none" class="logged-in">
	<h1>Pending Requests for <span class="fullnames"></span></h1>
	<table class="table table-hover">
		<thead>
			<th>Created On</th>
			<th>Amount</th>
			<th>Reason</th>
		</thead>
		<tbody id="emp-pending-table-body">
			<tr>
				<td>01/01/2000</td>
				<td>$200.00</td>
				<td>Because I wanted to.</td>
			</tr>
		</tbody>
	</table>

</div>

<script>
</script>


</div>
</body>
</html>